graph TB
    %% RMS v3 System Topology
    
    %% Entry Points
    main[main.tsx] --> App[App.tsx]
    main --> EventStoreProvider[EventStoreProvider]
    main --> QueryClient[QueryClient]
    main --> SW[Service Worker]
    main --> MSW[Mock Service Worker]
    
    %% Core Routing
    App --> Router[React Router]
    Router --> POS[POS Page]
    Router --> KDS[KDS Page]
    Router --> Inventory[Inventory Page]
    Router --> Customers[Customers Page]
    Router --> Reports[Reports Page]
    Router --> Settings[Settings Page]
    
    %% POS System
    POS --> POSComponents[POS Components]
    POSComponents --> OrderSummary[OrderSummary]
    POSComponents --> ProductGrid[ProductGrid]
    POSComponents --> PaymentModal[PaymentModal]
    POS --> EventStore[Event Store]
    POS --> PaymentProvider[Payment Provider]
    
    %% Event System
    EventStore --> PouchDB[PouchDB]
    EventStore --> EventTypes[Event Types]
    EventTypes --> SaleEvents[Sale Events]
    EventTypes --> PaymentEvents[Payment Events]
    EventTypes --> InventoryEvents[Inventory Events]
    
    %% Data Layer
    PouchDB --> IndexedDB[IndexedDB]
    PouchDB --> Replication[Replication]
    
    %% Inventory System
    Inventory --> InventoryEngine[Inventory Engine]
    InventoryEngine --> Recipes[Recipes]
    InventoryEngine --> StockLevels[Stock Levels]
    InventoryEngine --> OversellPolicy[Oversell Policy]
    
    %% RBAC System
    Settings --> AdminConsole[Admin Console]
    Settings --> TechnicalConsole[Technical Console]
    AdminConsole --> RBACGuard[RBAC Guard]
    TechnicalConsole --> RBACGuard
    RBACGuard --> Roles[Roles & Permissions]
    
    %% Payment System
    PaymentProvider --> Webhook[Webhook Handler]
    PaymentProvider --> PaymentStatus[Payment Status]
    Webhook --> IdempotencyCheck[Idempotency Check]
    
    %% UI Components
    POSComponents --> Select[Select Component]
    POSComponents --> Toast[Toast Provider]
    
    %% Testing Infrastructure
    TestUtils[Test Utils] --> renderWithProviders[renderWithProviders]
    TestUtils --> MSWHandlers[MSW Handlers]
    TestUtils --> TestData[Test Data]
    
    %% Build & Config
    ViteConfig[vite.config.ts] --> PWAPlugin[PWA Plugin]
    ViteConfig --> ReactPlugin[React Plugin]
    ESLintConfig[eslint.config.js] --> TypeScriptESLint[TypeScript ESLint]
    ESLintConfig --> UnusedImports[Unused Imports Plugin]
    
    %% PWA Features
    PWAPlugin --> Workbox[Workbox]
    Workbox --> CacheStrategy[Cache Strategy]
    Workbox --> OfflineShell[Offline Shell]
    
    %% Environment Split
    SW -.->|PROD only| Workbox
    MSW -.->|DEV only| MockHandlers[Mock Handlers]
    
    classDef page fill:#e1f5fe
    classDef component fill:#f3e5f5
    classDef store fill:#e8f5e8
    classDef config fill:#fff3e0
    classDef test fill:#fce4ec
    
    class POS,KDS,Inventory,Customers,Reports,Settings page
    class OrderSummary,ProductGrid,PaymentModal,Select,Toast component
    class EventStore,PouchDB,InventoryEngine store
    class ViteConfig,ESLintConfig config
    class TestUtils,renderWithProviders,MSWHandlers test